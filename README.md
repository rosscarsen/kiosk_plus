# kiosk Plus(<https://github.com/rosscarsen/kiosk_plus>)

## 使用前注意事項

- 首次使用默認中文繁體,後續再啟動使用上一次設置的語言。
- 登錄後,為了方便大廳頁面快速的使用,新開了一個線程把遠程日曆折扣、公司信息、商品分類、商品列表、商品備註數據、轮播圖每5分鐘一次同步到本地。
  - 後臺改了數據，在網絡良好情況需要最低等5分鐘後才是最新數據。
  - 由於新開了線程處理數據,對於設備要求相當較高,建議使用4線程以上設備。
- 無論當前處於哪一個頁面,當5分鐘內沒有任何操作,會進入輪播展示頁。

## 功能描述

- 登錄頁面
  - 登錄後存儲數據庫連接信息與歡迎頁背景圖

- 歡迎頁面
  - 右上角設備寬度30%高度30%區域以間隔不大於500毫秒點擊5下觸發解鎖設置
  - 輸入登錄密碼解鎖
    - 藍牙設置
      - 搜索設備
      - 連接設備並進行一次測試打印,以便存存儲藍牙信息供下單後票據列印
    - 退出登錄
      - 清空存儲於設備上的日曆折扣、公司信息、商品分類、商品列表、商品備註數據、轮播圖
      - 返回登錄頁面
- 大廳頁面
  - 頂部區域
    - 返回歡迎頁(當購物車有商品時,點擊返回會提示清空購物車對話框,無商品時直接進入歡迎頁)
    - 公司名稱
    - 購物車數量與金額（點擊可查看購物車詳情）
  - 左側第一大類
  - 右側部分
    - 商品分類
    - 商品GridView列表(點擊進入詳情頁面)
    - 通過點擊切換或滑動商品切換第一第二大類(注意:如通過滑動切換,向下滑動會逐級向下切換,向上滑動(如果在第二大類非第一個類目會逐一向上切換第二大類,切換到第二大類第一個後,此時為了性能考慮,會切換到上一大類第一個子類,不是最後一個子類最後一個商品所在位置)
- 詳情頁面
  - 頂部商品圖片，點擊可放大查看
  - 中間商品詳情
    - 商品名稱、商品單價、數量加減
    - 商品備註
    - 套餐選擇(默認會根據"套餐限制設置"默認選擇項目數(不是強制選擇默認會選擇一個，如果是強制選擇，默認勾選設置的"最多數量"個數))
  - 底部
    - 左側實時預覽當前商品總金額與商品數量（金額計算參考"金額計算方式"部分）
    - 右側添加到購物車按鈕
      - 有套餐情況下，沒有正確勾選，套餐區域會自動滾動到可視區域且打開折疊面板
      - 點擊添加到購物車按鈕後，會彈出成功提示框，3秒後自動關閉,跳轉到大廳頁面
  - 購物車頁面
    - 頂部
      - 返回大廳頁面
    - 中間
      - 條款與細則
      - 商品列表
        - 商品圖片、名稱、商品單價、數量、金額
        - 小計匯總
        - 刪除、修改
          - 刪除--從購物車中移除此商品
          - 修改(進入詳情頁面)--在詳情頁可修改商品數量、備註、套餐，修改後自動更新(購物列表與對應金額、大廳購物車總數與金額顯示)
    - 底部
      - 總金額與商品數量
      - 送單按鈕
  - 支付類型頁
    - 主體支付類型選擇
    - 底部
      - 返回按鈕--返回購物車頁面
      - 確認按鈕--確認支付類型,並進入支付頁面
  - 支付頁面
    - 主體(當沒有打印藍牙信息時,會顯示“出現異常，請聯繫櫃檯人員”，當有打印藍牙信息時,會顯示“請將二維碼或卡放到卡口讀取”)
    - 讀取成功後,寫入遠程數據庫，清除購物車，打印訂單至藍牙設備

## 金額計算方式

- 基础金额 = 商品單價 x 商品數量
- 備註金額
  - 加价 (累加選中 備註單價 x 商品數量)
  - 折扣 (累加選中 (備註折扣 / 100) x (商品數量 x 商品
  - 倍數 (累加選中 商品單價 x 商品數量 x 備註倍數)
  - 最終備註金額 = 加价 - 折扣 + 倍數
- 套餐金額
  - 累加選中 (套餐单价 * 套餐数量)
  - 最终套餐金额 = 套餐金额 * 商品数量
- 最终总金额 = (基础金额 + 最終備註金額 + 最终套餐金额) x (1 - 折扣 / 100)
